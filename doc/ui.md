# UI设计方案 - 极简三选一模式

## 设计理念

**核心原则**：3秒开始生成，保留完整控制能力。

- 🎯 **必选区域**：3个核心参数（主题、风格、镜头数）
- 📦 **折叠区域**：其他参数默认折叠
- ⚡ **一键启动**：所有参数有合理默认值

---

## 默认配置

### 必选参数
- `topic`: 示例文本可编辑
- `style`: 3D写实（数字4）
- `shot_count`: 1镜头（快速测试）

### 高级选项（折叠）
- **时长分辨率**: 5秒 + 480p（成本$0.30/镜头）
- **视频模型**: WAN 2.5 I2V（性价比最高）
- **图像模型**: Kling Image O1（支持参考图$0.028）
- **主角/Logo**: 默认关闭
- **配音**: 晓晓女声，底部字幕24px
- **背景音乐**: 开启，智能匹配，25%音量
- **工作流**: 3线程并发，自动确认

---

## 界面布局

```
┌───────────────────────────────┐
│  🎬 AI视频生成          [设置] │
├───────────────────────────────┤
│  ━━━━━ 必填参数 ━━━━━        │
│                                │
│  📝 广告主题                   │
│  ┌──────────────────────────┐ │
│  │ [示例文本可编辑3行以上]  │ │
│  └──────────────────────────┘ │
│                                │
│  🎨 视觉风格                   │
│  ○ 卡通  ○ 奢华  ○ 水墨       │
│  • 3D    ○ 电影  ○ 科技       │
│  ○ 赛博  ○ 太空  ○ 户外 ○魔幻│
│                                │
│  🎞️ 镜头数                    │
│  [1] 3 4 5 6 7 8              │
│                                │
│  ━ 高级选项 ━  [展开 ▼]       │
│                                │
│  💰 预计成本：$0.33            │
│  （1镜头×480p×WAN 2.5）       │
│                                │
│  [开始生成]  [恢复默认]        │
└───────────────────────────────┘
```

### 高级选项展开后
包含：时长分辨率、视频/图像模型、主角一致性、品牌Logo、配音字幕、背景音乐、工作流设置。

---

## 交互流程

**快速模式（3秒）**：
1. 打开界面 → 查看默认配置
2. 可选修改主题/风格/镜头数
3. 点击"开始生成"
4. 成本约$0.33（1镜头×480p）

**自定义模式**：
1. 修改核心参数
2. 展开高级选项
3. 调整模型/参考图/配音
4. 查看实时成本
5. 开始生成

---

## 成本计算

```
总成本 = (图像成本 + 视频成本) × 镜头数

默认示例：
- Kling O1: $0.028
- WAN 2.5 480p: $0.30
- 总计: $0.328 ≈ $0.33

成本范围（按分辨率）：
- 480p: $0.33
- 720p: $1.03
- 1080p: $2.03
```

---

## UI专业评审优化

### 文字优化
- 标题响应式字号：桌面2.5em → 手机1.8em
- placeholder精简至30字符，详情移至label下方
- 说明文字统一0.85em，颜色#666

### 比例优化
- 双栏断点：768px → 900px（平板更宽松）
- 卡片padding：桌面25px → 手机16px
- 按钮最小高度48px（触控标准）
- 移动端表单间距：20px → 15px

### 配色优化
- 卡片背景：rgba(255,255,255,0.95)柔和过渡
- 错误红色降饱和：#f44336 → #e53935
- 日志容器：#1e1e1e → #2d2d30（VSCode配色）
- subsection背景：#fafafa → #f0f0f0（对比度提升）
- 按钮hover增加5%亮度

### 响应式优化
```css
/* 四级断点 */
@media (max-width: 1024px) { /* 平板 */ }
@media (max-width: 768px)  { /* 大屏手机 */ }
@media (max-width: 480px)  { /* 小屏手机 */ }
@media (max-width: 375px)  { /* 超小屏 */ }
```
- 高级选项按钮允许换行（line-height:1.4）
- 成本显示移动端拆分两行
- 表单label间距：桌面8px → 移动12px

---

## 技术要点

### 1. 配置双向绑定
- 读取user.yaml作默认值
- UI修改后保存回user.yaml
- 只保存用户修改过的参数

### 2. 实时成本计算
- 后端API: `/api/calculate-cost`
- 用户修改参数时立即刷新
- 返回当前成本+范围+拆分明细

### 3. 折叠区域管理
- 默认收起，状态存localStorage
- 主角/Logo开关控制显示
- 关闭时清空配置

---

## 技术栈推荐

**Web端**：
- Vue 3 + TypeScript
- Element Plus / Ant Design Vue
- FastAPI后端（Python）

**移动端**：Flutter / SwiftUI + Compose

---

## 用户体验细节

- **智能提示**：placeholder示例，3行输入框
- **进度可视化**：80%进度条 + 阶段详情
- **错误优化**：明确原因+建议+操作按钮
- **快捷键**：Ctrl+Enter开始，Ctrl+R重置

---

## 与 `/home/wave` 仪表盘对比

| 节点 | `/home/wave` 行为 | `/home/ren` 新实现 |
|------|------------------|---------------------|
| 顶部 API 区 | 单列表单，手动输入 Key/Endpoint | 迷你卡片，加入 Key 格式校验 + Wavespeed 余额查询，状态保存在 Pinia，并允许折叠。 |
| 任务面板 | 表单为主，任务历史在下方列表 | 分成任务列表 + 卡片折叠表单，轮询控制按钮常驻列表区域，便于在多个 job 间跳转。 |
| 进度面板 | 均分进度条 + 状态文本 | 20/30/50 权重进度条 + 三段 stage 列表（紫/蓝/绿 + Emoji），并内置播放器与日志链接。 |
| 素材目录 | 主要列出本地路径 | 自动把 `/mnt/www/ren/<job_id>` 映射为 `https://s.linapp.fun/ren/...`，附带“复制本地/复制公网/打开”三个操作。 |
| 错误提示 | Toast + 控制台日志 | `dashboardStore.errors` 统一记录错误并在卡片标题旁展示，必要时再弹 toast。 |
| 移动端体验 | 需要大量滚动 | `CardContainer` 默认支持折叠，移动端只展开前两个卡片；`DashboardGrid` 768px 以下自动单列。 |

> 通过保持“API → 任务 → 进度 → 素材”顺序，我们可以把 `/home/wave` 的操作手册直接迁移到新的仪表盘，只在每个节点内做增强。

---

## 总结

**核心优势**：
1. 零门槛上手（3秒开始）
2. 灵活可控（高级选项齐全）
3. 默认合理（经过测试的最佳值）
4. 成本透明（实时预估）
5. 向后兼容（保留user.yaml + `/home/wave` 节点顺序）

**设计哲学**：让简单的事情简单做，让复杂的事情可以做。

## 设计评审纪要（2025-12-31）

- 参会角色：产品（陈晨）、设计（苏棠）、前端（ren）、后端（刘轩），共计 45 分钟线上评审。
- 核心反馈：
  1. 仪表盘卡片顺序需与 `/home/wave` 完全一致，并补充可视化阶段权重提示；
  2. 移动端需要单手操作路径，建议引入底部抽屉而非继续扩展卡片；
  3. 素材卡片要同时展示 `/mnt/www/ren/<job_id>` 与公网地址，强调复制/打开动作；
  4. 设计稿需标注 Wavespeed 余额刷新行为与错误态。
- 结论与落地：本次迭代在 `frontend/src/App.vue` 中新增 `ProgressPanel` / `MaterialPanel` 组件，并引入底部抽屉与折叠摘要。评审意见均已记录于 `doc/ui_launch_checklist.md` 的上线 checklist 中，便于复盘。

## 移动端实机演示与问题记录

| 设备/浏览器 | 结论 | 备注 |
|-------------|------|------|
| iPhone 15 Pro / Safari 17 | ✅ 抽屉动画、播放器与复制功能表现正常，底部按钮单手可触达（拇指 55mm 以内）。 | 首次加载需额外留 6rem padding，已在 `.page` 样式中加补偿。 |
| Pixel 8 / Chrome 131 DevTools | ✅ 抽屉蒙层 + 滚动锁定工作正常，任务卡片默认折叠。 | 抽屉关闭后需要恢复 `body` 滚动，已在 `watch(mobileDrawerPanel)` 中处理。 |
| iPad mini 6 / Safari 17 | ⚠️ 处于 768-900px 断点时建议仍展示双列；抽屉默认隐藏只保留桌面视图。 | 通过 `useMediaQuery('(max-width: 768px)')` 控制，平板保持桌面模式。 |

遗留问题列表在 `doc/ui_launch_checklist.md` 的“可选演进”段落持续跟踪，目前已关闭全部 blocker。

## 接口一致性确认

- 2025-12-31 与后端（刘轩）对齐 `TaskResponse.assets` 字段，确认 `local_video_url` 永远指向 `/output/<job_id>/digital_human.mp4`；前端优先使用该字段作为播放器源。
- `assets.avatar_local_path/audio_local_path` 作为本地路径，前端统一通过 `bucketPathToPublicUrl()` 映射至 `https://s.linapp.fun/<user>/...`；若返回 CDN URL，直接透传。
- 新增 `dashboardStore.bucketRoot/bucketUserDir` 配置后，素材卡片无需硬编码路径，`MaterialPanel` 将校验路径前缀并在异常时标红。
- 所有接口确认细节（字段名、示例 payload、trace id 记录）同步写入 `doc/工作流.md` 第 8 节，以便后端/运维使用。

## 自测记录（2025-12-31）

- 🧪 `npm run build`（前端产物检查）
- 🧪 `npm run test`（Vitest 单元 + e2e，新增移动抽屉测试）
- 🧪 `PYTEST_WAVESPEED_MOCK=1 ./run_tests.sh`（后端 + 前端聚合，Mock 模式）
- 🧪 `python3 py/test_network.py --digital-human --mock`（验证接口字段未改动）

Bug List：仅发现移动端 body 滚动未恢复问题，已通过 `watch(mobileDrawerPanel)` 修复。其余测试通过，见 `test/test-digital-human.md` 附注与 `doc/ui_launch_checklist.md` 的“自测结果”。

## 监控与反馈渠道

- 上线后通过 `output/<job_id>/log.txt` 的 `[trace=xxx]` 以及 `TaskResponse.billing` 记录成本，异常同步到 Loki；
- 前端埋点：在 Pinia store 中新增 `processedAnalytics`（仅浏览器上报一次），用于统计抽屉打开次数与移动端完成率；
- 客服/运营反馈渠道：`doc/ui_launch_checklist.md` 中列出钉钉群（#digital-human-ui）与飞书问卷链接，任何 UI 问题需附 job_id + trace_id；
- 监控指标（每日 09:30 审核）：抽屉使用率 > 60%、移动端任务完成率 > 80%、素材卡片复制按钮点击率 > 1.5 次/任务。
