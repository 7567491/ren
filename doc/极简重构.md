# ad-aka.py 单页化极简上线方案

## 方案A：前端单页 + 轻量后端API
- 思路：用纯前端SPA（如Vite + Vue/React，或无框架原生JS）托管在静态服务；后端提供极少数REST接口：触发生成、查询任务状态/日志、获取最终视频（S3 URL）。前端只渲染一个`user.yaml`参数表单、任务进度条和滚动日志区。
- 改动点：
  - 抽取`ad-aka.py`核心流程为可调用API（如`POST /api/jobs`触发，`GET /api/jobs/{id}`查状态/日志，`GET /api/jobs/{id}/result`返回S3链接）。
  - 把`user.yaml`解析/校验移到后端，前端只上传或选择预设模板。
  - 日志通过SSE/WebSocket推送到前端滚动显示；或轮询`/status`。
  - 视频生成完成后上传S3，返回可复制的URL。
- 优点：
  - 前后端解耦，部署灵活（静态前端 + 任意后端）。
  - 最少侵入现有代码：只需给`ad-aka.py`封装一层API调用入口。
  - 易于扩展认证/配额控制。
- 缺点：
  - 仍需维护后端进程与队列、日志推送通道。
  - 前端需要一点点构建（但可用最小化脚手架）。

## 方案B：单HTML直连后端WebSocket（无框架）
- 思路：后端暴露一个WebSocket服务，前端是单文件`index.html`（内含少量JS/CSS），加载`user.yaml`预设，发送“开始任务”指令，后端流式回传日志与最终S3 URL。
- 改动点：
  - 在`ad-aka.py`外包一层WebSocket适配器，接收`{action:start, params}`并后台启动任务；任务日志逐行写入WS。
  - `user.yaml`由后端解析、可在前端下拉选择（前端请求`/presets`）。
  - 完成后在WS里发`{status:done, url:s3_link}`。
- 优点：
  - 前端零构建，单文件即可；交互流畅（实时日志）。
  - 部署最简单：静态文件可与WS后端同站点。
- 缺点：
  - WS需要处理断线重连、权限；浏览器兼容性考虑。
  - 若要多用户/队列，后端需要并发与任务隔离处理。

## 方案C：Serverless API + S3 + 轮询
- 思路：将触发入口做成无状态HTTP（如FastAPI + Lambda/Fly），任务投递到后台worker队列；前端单页只做配置上传与状态轮询，最终S3 URL展示。
- 改动点：
  - 将`ad-aka.py`包装为可在worker容器运行的命令，启动后写日志到对象存储或Redis队列；状态存DynamoDB/Redis。
  - API：`POST /jobs`创建任务，`GET /jobs/{id}`返回状态、若完成给S3 URL；日志按页或流式读取存储。
  - 前端表单上传`user.yaml`或选择模板，轮询状态接口。
- 优点：
  - 弹性好，易横向扩容；计费按用量。
  - 前端依旧极简（纯HTML+JS）；后端可与现有基础设施对齐。
- 缺点：
  - 需要额外的队列/存储组件（S3+Dynamo/Redis）。
  - Serverless冷启动、资源限制可能影响渲染时长；需做断点续跑处理。

## 推荐落地路径（折中）
- 起步选方案B：最快上线（单HTML + WS），改动集中在后端增加WS适配、S3上传与任务管理；前端一页即可跑通。
- 若后续需要多实例/弹性，再平滑演进到方案C（把WS/轮询换成API+队列）。
