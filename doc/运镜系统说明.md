# 运镜系统说明

## 概述

已在`ad-aka.py`中集成M1-M6标准化运镜系统，基于《最佳实践》和《最佳脚本》文档。

## 6种运镜模式

| 代号 | 名称 | 适用场景 | 时长 | 运动强度 |
|------|------|----------|------|---------|
| **M1** | 推进特写 | 开场钩子、核心功能强调、重点展示 | 3-4s | 7 |
| **M2** | 俯视展开 | 云架构、数据中心、全局视角、宏观展示 | 3-5s | 5 |
| **M3** | 平移扫过 | 多场景应用、功能列表、并列展示 | 4-5s | 6 |
| **M4** | 旋转环绕 | 产品展示、AI模型可视化、立体呈现 | 3-4s | 8 |
| **M5** | 拉出揭示 | 从单点到整体价值、结尾升华、全局揭示 | 4-5s | 7 |
| **M6** | 分屏对比 | Before/After对比、多场景并行、效果证明 | 3-4s | 3 |

## 智能分配规则

系统根据以下规则自动分配运镜模式：

### 1. 位置优先规则
- **第1个镜头（开场）** → 强制使用 **M1（推进特写）**
- **最后1个镜头（结尾）** → 强制使用 **M5（拉出揭示）**

### 2. 关键词检测规则（中间镜头）

按优先级从高到低：

| 优先级 | 检测关键词 | 分配运镜 |
|--------|-----------|---------|
| 1 | 对比、vs、before、after、传统、人工、使用前、使用后 | **M6** 分屏对比 |
| 2 | 架构、数据中心、全球、网络、节点、俯瞰 | **M2** 俯视展开 |
| 3 | 产品、界面、平台、模型、展示 | **M4** 旋转环绕 |
| 4 | 多个、多种、应用、场景、功能列表 | **M3** 平移扫过 |
| 5 | 其他（默认） | **M2/M3/M4** 循环 |

### 3. 示例

**5镜头云计算广告：**
```
镜头1: "服务器宕机告警闪烁" → M1 推进特写（开场）
镜头2: "传统数据中心俯瞰全景" → M6 分屏对比（包含"传统"）
镜头3: "产品界面展示智能扩容" → M4 旋转环绕（包含"产品"+"界面"）
镜头4: "对比传统运维vs AI云" → M6 分屏对比（包含"对比"+"vs"）
镜头5: "全球节点连接网络" → M5 拉出揭示（结尾）
```

## 使用方法

### 自动模式（推荐）

运行`python3 py/ad-aka.py`时，系统会：

1. 在**阶段2（生成连贯分镜脚本）**自动为每个镜头分配运镜
2. 在日志中显示：
   ```
   🎬 运镜模式: M1 - 推进特写 (开场钩子、核心功能强调、重点展示)
   ```
3. 将运镜信息保存到`22_shots_script.json`：
   ```json
   {
     "camera_movement": {
       "code": "M1",
       "name": "推进特写",
       "description": "smooth zoom in push shot, from medium shot to close-up...",
       "motion_strength": 7
     }
   }
   ```

### 手动优化

如果自动分配不满意，可以修改场景描述：

**想要M2（俯视展开）但被识别为M6？**
```
❌ "传统数据中心全景" → M6（因为包含"传统"）
✅ "数据中心鸟瞰全局架构" → M2（包含"架构"）
```

**想要M6（分屏对比）但被识别为M4？**
```
❌ "产品性能提升界面" → M4（因为包含"产品"）
✅ "对比使用前后产品性能" → M6（包含"对比"+"前后"）
```

## 运镜描述（用于视频生成）

系统会将运镜描述自动插入到DeepSeek提示词中：

```
风格要求：
- 视觉风格：{style_template['visual_style']}
- 色彩方案：{style_template['color_palette']}
- 光影：{style_template['lighting']}
- 镜头运动（必须严格遵守）：smooth zoom in push shot, from medium shot
  to close-up, focus pulling, cinematic depth of field
```

这确保生成的视频prompt严格遵守专业运镜规范。

## 与WavespeedAI集成

运镜信息中的`motion_strength`参数未来可用于：

```python
# 在视频生成API调用中使用
video_params = {
    "motion_strength": shot['camera_movement']['motion_strength'],
    "motion_type": extract_motion_type(shot['camera_movement']['description'])
}
```

目前该参数已保存在JSON中，便于后续优化。

## 测试

运行测试脚本验证运镜系统：

```bash
python3 test/test_camera_movement.py
```

输出示例：
```
镜头 1/5: 服务器宕机告警闪烁
  → 运镜: M1 - 推进特写
  → 适用: 开场钩子、核心功能强调、重点展示
```

## 最佳实践建议

### 1. 场景描述命名规范

为了让智能分配更准确，建议按以下格式命名场景：

```
✅ 好的命名：
- "服务器宕机告警画面"（开场，自动M1）
- "云平台架构俯瞰展示"（架构，自动M2）
- "多场景应用并列展示"（多场景，自动M3）
- "产品界面360度展示"（产品，自动M4）
- "全球节点网络全景"（结尾，自动M5）
- "传统vs智能对比画面"（对比，自动M6）

❌ 避免模糊命名：
- "第一个镜头"（无法识别场景类型）
- "中间部分"（无法分配运镜）
```

### 2. 运镜组合建议

**3镜头广告（9-13秒）：**
- 镜头1: M1（推进特写）
- 镜头2: M4（旋转环绕）或 M6（分屏对比）
- 镜头3: M5（拉出揭示）

**6镜头广告（21-28秒）：**
- 镜头1: M1（推进特写）
- 镜头2: M2（俯视展开）
- 镜头3: M4（旋转环绕）
- 镜头4: M3（平移扫过）
- 镜头5: M6（分屏对比）
- 镜头6: M5（拉出揭示）

### 3. 关键词优化技巧

如果需要强制使用某个运镜，在场景描述中加入对应关键词：

```python
# 强制M2（俯视展开）
"数据中心鸟瞰全局" → 包含"数据中心"

# 强制M3（平移扫过）
"多场景应用展示" → 包含"多场景"+"应用"

# 强制M4（旋转环绕）
"产品界面立体展示" → 包含"产品"+"界面"

# 强制M6（分屏对比）
"传统运维vs AI云" → 包含"传统"+"vs"
```

## 未来扩展

### 计划功能

1. **自定义运镜模式**：允许用户定义M7、M8等新运镜
2. **运镜冲突检测**：避免相邻镜头使用相同运镜
3. **运镜节奏优化**：根据整体情绪曲线动态调整motion_strength
4. **A/B测试支持**：生成多个运镜方案对比效果

### 配置化

未来可将运镜系统移至`config.yaml`：

```yaml
camera_movements:
  M1:
    name: "推进特写"
    description: "smooth zoom in push shot..."
    keywords: []  # 不依赖关键词，仅用于开场
    priority: 100  # 最高优先级

  M6:
    name: "分屏对比"
    description: "split-screen comparison..."
    keywords: ["对比", "vs", "传统", "before", "after"]
    priority: 90  # 次高优先级
```

## 版本历史

- **v1.0** (2025-12-24): 初始版本，集成M1-M6运镜系统
- 支持智能关键词检测
- 保存运镜信息到JSON
- 完整日志输出

## 参考文档

- [最佳实践.md](./最佳实践.md) - 广告视频工作流规范
- [最佳脚本.md](./最佳脚本.md) - 3种脚本类型×6种运镜模式模板
